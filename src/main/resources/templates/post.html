<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="'Пост: ' + ${post.title}"></title>
    <script>
        function enableCommentEdit(commentId) {
            document.getElementById('comment-text-' + commentId).style.display = 'none';
            const input = document.getElementById('comment-input-' + commentId);
            input.style.display = 'inline';
            input.focus();
        }

        function saveComment(commentId) {
            const text = document.getElementById('comment-input-' + commentId).value;
            fetch('/posts/comments/update/' + commentId, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text })
            }).then(() => location.reload());
        }
    </script>
</head>
<body>
<h1 th:text="${post.title}"></h1>

<p th:utext="${#strings.replace(#strings.replace(post.text, '\r\n', '<br/>'), '\n', '<br/>')}"></p>

<div>
    <h3>Теги</h3>
    <ul>
        <li th:each="tag : ${post.tags}" th:text="${tag.name}"></li>
    </ul>
</div>

<div>
    <form th:action="@{/posts/delete/{id}(id=${post.id})}" method="post">
        <button type="submit">Удалить</button>
    </form>
    <button th:onclick="'window.location.href=\'/posts/update/' + ${post.id} + '\''">Редактировать</button>
</div>

<div>
    <h3>Комментарии</h3>
    <ul>
        <li th:each="comment : ${post.comments}">
            <span id="comment-text-[[${comment.id}]]"
                  th:utext="${#strings.replace(#strings.replace(comment.text, '\r\n', '<br/>'), '\n', '<br/>')}"></span>
            <input id="comment-input-[[${comment.id}]]" type="text" style="display: none;" data-comment-id="[[${comment.id}]]">
            <button type="button" onclick="saveComment([[${comment.id}]])">Сохранить</button>
            <form th:action="@{/posts/comments/delete/{id}(id=${comment.id})}" method="post">
                <button type="submit">Удалить</button>
            </form>
        </li>
    </ul>
</div>

<form th:action="@{/posts/{id}/comments(id=${post.id})}" method="post" th:object="${newComment}">
    <textarea th:field="*{text}" rows="5" cols="40" required></textarea>
    <button type="submit">Добавить комментарий</button>
</form>

<div>
    <form th:action="@{/posts/like/{id}(id=${post.id})}" method="post">
        <button type="submit">Лайк (текущие: [[${post.likes}]])</button>
    </form>
</div>

</body>
</html>